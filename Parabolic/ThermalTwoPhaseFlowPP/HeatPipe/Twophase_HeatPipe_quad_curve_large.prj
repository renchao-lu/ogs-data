<?xml version="1.0" encoding="ISO-8859-1"?>

<OpenGeoSysProject>
    <mesh>HeatPipe_2D.vtu</mesh>
    <geometry>HeatPipe_2D.gml</geometry>

    <processes>
        <process>
            <name>GW23</name>
            <type>THERMAL_TWOPHASE_WITH_PP</type>
            <integration_order>2</integration_order>

            <process_variables>
                <gas_pressure> gas_pressure </gas_pressure>
                <capillary_pressure> capillary_pressure</capillary_pressure>
                <temperature>temperature</temperature>
            </process_variables>

            <jacobian_assembler>
                <type>CentralDifferences</type>
                <component_magnitudes>1e6 1e6 300</component_magnitudes>
                <relative_epsilons>1e-6 1e-6 1e-7</relative_epsilons>
            </jacobian_assembler>


            <material_property>
                <fluid>
                    <liquid_density>
                        <type>Constant</type>
                        <value> 1.e3 </value>
                    </liquid_density>
                    <gas_density>
                        <type>IdealGasLaw</type>
                        <molar_mass> 0.029 </molar_mass>
                    </gas_density>
                    <liquid_viscosity>
                        <type>Constant</type>
                        <value> 2.938e-4 </value>
                    </liquid_viscosity>
                    <gas_viscosity>
                        <type>Constant</type>
                        <value> 1.8e-5 </value>
                    </gas_viscosity>
                </fluid>
                <porous_medium>
                    <porous_medium id="0">
                        <permeability>
                            <values>1e-12</values>
                        </permeability>
                        <porosity>
                            <type>Constant</type>
                            <value> 0.4  </value>
                        </porosity>
                        <storage>
                            <type>Constant</type>
                            <value> 0.0 </value>
                        </storage>
                       <capillary_pressure>
                            <type>Curve</type>
                            <curve>
                                <coords>0	0.01010101	0.02020202	0.03030303	0.04040404	0.050505051	0.060606061	0.070707071	0.080808081	0.090909091	0.101010101	0.111111111	0.121212121	0.131313131	0.141414141	0.151515152	0.161616162	0.171717172	0.181818182	0.191919192	0.202020202	0.212121212	0.222222222	0.232323232	0.242424242	0.252525253	0.262626263	0.272727273	0.282828283	0.292929293	0.303030303	0.313131313	0.323232323	0.333333333	0.343434343	0.353535354	0.363636364	0.373737374	0.383838384	0.393939394	0.404040404	0.414141414	0.424242424	0.434343434	0.444444444	0.454545455	0.464646465	0.474747475	0.484848485	0.494949495	0.505050505	0.515151515	0.525252525	0.535353535	0.545454545	0.555555556	0.565656566	0.575757576	0.585858586	0.595959596	0.606060606	0.616161616	0.626262626	0.636363636	0.646464646	0.656565657	0.666666667	0.676767677	0.686868687	0.696969697	0.707070707	0.717171717	0.727272727	0.737373737	0.747474747	0.757575758	0.767676768	0.777777778	0.787878788	0.797979798	0.808080808	0.818181818	0.828282828	0.838383838	0.848484848	0.858585859	0.868686869	0.878787879	0.888888889	0.898989899	0.909090909	0.919191919	0.929292929	0.939393939	0.949494949	0.95959596	0.96969697	0.97979798	0.98989899	1
                                </coords>
                                <values>29346.0554793536	28619.1277180673	27916.2720285716	27237.0156387905	26580.8857766478	25947.4096700673	25336.1145469731	24746.5276352888	24178.1761629385	23630.5873578460	23103.2884479350	22595.8066611296	22107.6692253536	21638.4033685309	21187.5363185853	20754.5953034407	20339.1075510210	19940.6002892501	19558.6007460518	19192.6361493499	18842.2337270685	18506.9207071313	18186.2243174622	17879.6717859851	17586.7903406238	17307.1072093023	17040.1496199444	16785.4448004740	16542.5199788149	16310.9023828911	16090.1192406263	15879.6977799445	15679.1652287696	15488.0488150253	15305.8757666357	15132.1733115245	14966.4686776156	14808.2890928329	14657.1617851004	14512.6139823417	14374.1729124809	14241.3658034418	14113.7198831482	13990.7623795241	13872.0205204933	13757.0215339796	13645.2926479070	13536.3610901994	13429.7540887805	13324.9988715743	13221.6226665047	13119.1527014954	13017.1162044705	12915.0404033537	12812.4525260690	12708.8798005401	12603.8494546910	12496.8887164456	12387.5248137277	12275.2849744612	12159.6964265700	12040.2863979779	11916.5821166088	11788.1108103866	11654.3997072352	11514.9760350784	11369.3670218401	11217.0998954441	11057.7018838144	10890.7002148749	10715.6221165493	10531.9948167616	10339.3455434356	10137.2015244952	9925.08998786433	9702.53816146679	9469.07327322648	9224.22255106726	8967.51322291302	8698.47251668762	8416.62766031493	8121.50588171883	7812.63440882319	7489.54046955188	7151.75129182878	6798.79410357775	6430.19613272267	6045.48460718742	5644.18675489586	5225.82980377186	4789.94098173930	4336.04751672206	3863.67663664400	3372.35556942900	2861.61154300092	2330.97178528364	1779.96352420104	1208.11398767699	614.950403635348	0
                                </values>
                            </curve>
                        </capillary_pressure>
                        <relative_permeability>
                            <relative_permeability id="0">
                                <type>NonWettingPhaseVanGenuchten</type>
                                <sr>  0.0 </sr>
                                <smax> 0.6 </smax>
                                <m> 0.3288590604 </m>
                                <krel_min> 0.0 </krel_min>
                            </relative_permeability>
                            <relative_permeability id="1">
                                <type>WettingPhaseVanGenuchten</type>
                                <sr>  0.4 </sr>
                                <smax> 1. </smax>
                                <m> 0.3288590604 </m>
                                <krel_min> 0.0 </krel_min>
                            </relative_permeability>
                        </relative_permeability>
                    </porous_medium>
                </porous_medium>
            </material_property>

            <secondary_variables>
                <secondary_variable type="static" internal_name="saturation" output_name="saturation" />
                <secondary_variable type="static" internal_name="pressure_wetting" output_name="pressure_wetting" />
            </secondary_variables>

            <specific_body_force>0 0</specific_body_force>
            <mass_lumping> true </mass_lumping>
            <diffusion_coeff_component_b> diff_coef_b </diffusion_coeff_component_b>
            <diffusion_coeff_component_a> diff_coef_a </diffusion_coeff_component_a>
            <specific_heat_capacity_solid> Cs </specific_heat_capacity_solid>
            <specific_heat_capacity_water> Cwater </specific_heat_capacity_water>
            <specific_heat_capacity_dry_air> Cair </specific_heat_capacity_dry_air>
            <specific_heat_capacity_water_vapor> Cvapor </specific_heat_capacity_water_vapor>
            <heat_conductivity_dry_solid> lambda_dry</heat_conductivity_dry_solid>
            <heat_conductivity_wet_solid> lambda_wet</heat_conductivity_wet_solid>
            <density_solid> rho_solid </density_solid>
            <latent_heat_evaporation> latent_heat_evp </latent_heat_evaporation>
        </process>
    </processes>

    <parameters>
         <parameter>
            <name>HEN0</name>
            <type>Constant</type>
            <value>7.65E-6</value>
        </parameter>
        <parameter>
            <name>pc_Dirichlet_left</name>
            <type>Constant</type>
            <value>1.736416339569494e+03</value>
        </parameter>
        <parameter>
            <name>T_Dirichlet_left</name>
            <type>Constant</type>
            <value>343</value>
        </parameter>
        <parameter>
            <name>pg_Dirichlet_left</name>
            <type>Constant</type>
            <value>101934</value>
        </parameter>
        <parameter>
            <name>T_0</name>
            <type>Constant</type>
            <values>343.15</values>
        </parameter>
        <parameter>
            <name>pc_0</name>
            <type>Constant</type>
            <values>1.327316794077718e+04</values>
        </parameter>
        <parameter>
            <name>pg_0</name>
            <type>Constant</type>
            <value>114578</value>
        </parameter>
         <parameter>
            <name>T_neumann</name>
            <type>Constant</type>
            <value>100</value>
        </parameter>
         <parameter>
            <name>henry_const</name>
            <type>Constant</type>
            <value>7.65e-6</value>
        </parameter>
         <parameter>
            <name>diff_coef_b</name>
            <type>Constant</type>
            <value>2.6e-6</value>
        </parameter>
        <parameter>
            <name>diff_coef_a</name>
            <type>Constant</type>
            <value>0.0</value>
        </parameter>
        <parameter>
            <name>Cs</name>
            <type>Constant</type>
            <value>700</value>
        </parameter>
        <parameter>
            <name>Cwater</name>
            <type>Constant</type>
            <value>4187</value>
        </parameter>
        <parameter>
            <name>Cair</name>
            <type>Constant</type>
            <value>733</value>
        </parameter>
        <parameter>
            <name>Cvapor</name>
            <type>Constant</type>
            <value>4187</value>
        </parameter>
        <parameter>
            <name>lambda_dry</name>
            <type>Constant</type>
            <value>0.582</value>
        </parameter>
        <parameter>
            <name>lambda_wet</name>
            <type>Constant</type>
            <value>1.14</value>
        </parameter>
        <parameter>
            <name>rho_solid</name>
            <type>Constant</type>
            <value>2650</value>
        </parameter>
        <parameter>
            <name>latent_heat_evp</name>
            <type>Constant</type>
            <value>2258000</value>
        </parameter>
    </parameters>

    <time_loop>
        <processes>
            <process ref="GW23">
                <nonlinear_solver>basic_newton</nonlinear_solver>
                <convergence_criterion>
                    <type>DeltaX</type>
                    <norm_type>NORM2</norm_type>
                    <abstol>1.e-5</abstol>
                </convergence_criterion>
                <time_discretization>
                <type>CrankNicolson</type>
                <theta>0.5</theta>
                </time_discretization>

                <output>
                    <variables>
                        <variable> capillary_pressure </variable>
                        <variable> gas_pressure </variable>
                        <variable> saturation </variable>
                        <variable> pressure_wetting </variable>
                        <variable> temperature </variable>
                    </variables>
                </output>
            </process>
        </processes>

        <time_stepping>
            <type>FixedTimeStepping</type>
            <t_initial>0</t_initial>
            <t_end>1000000.0</t_end>
           <timesteps>
                <pair><repeat>1000</repeat><delta_t>1000</delta_t></pair>
                <pair><repeat>100</repeat><delta_t>2000</delta_t></pair>
            </timesteps>
        </time_stepping>

        <output>
            <type>VTK</type>
            <prefix>thermaltwophaseflow</prefix>
            <timesteps>
                <!-- only output last timestep -->
                <pair><repeat> 1 </repeat><each_steps> 1000 </each_steps></pair>
            </timesteps>
            <output_iteration_results>false</output_iteration_results>
        </output>
    </time_loop>

    <process_variables>
        <process_variable>
            <name>gas_pressure</name>
            <components>1</components>
            <order>1</order>

            <initial_condition>pg_0</initial_condition>

            <boundary_conditions>
                 <boundary_condition>
                    <geometrical_set>HeatPipe_2D</geometrical_set>
                    <geometry>PLY_LEFT</geometry>
                    <type>Dirichlet</type>
                    <parameter>pg_Dirichlet_left</parameter>
                </boundary_condition>
            </boundary_conditions>

        </process_variable>
        <process_variable>
            <name>capillary_pressure</name>
            <components>1</components>
            <order>1</order>

            <initial_condition>pc_0</initial_condition>

            <boundary_conditions>
                <boundary_condition>
                    <geometrical_set>HeatPipe_2D</geometrical_set>
                    <geometry>PLY_LEFT</geometry>
                    <type>Dirichlet</type>
                    <parameter>pc_Dirichlet_left</parameter>
                </boundary_condition>
            </boundary_conditions>

        </process_variable>
        <process_variable>
            <name>temperature</name>
            <components>1</components>
            <order>1</order>

            <initial_condition>T_0</initial_condition>

            <boundary_conditions>
                <boundary_condition>
                    <geometrical_set>HeatPipe_2D</geometrical_set>
                    <geometry>PLY_LEFT</geometry>
                    <type>Dirichlet</type>
                    <parameter>T_Dirichlet_left</parameter>
                </boundary_condition>
                <boundary_condition>
                    <geometrical_set>HeatPipe_2D</geometrical_set>
                    <geometry>PLY_RIGHT</geometry>
                    <type>Neumann</type>
                    <parameter>T_neumann</parameter>
                </boundary_condition>
            </boundary_conditions>

        </process_variable>
    </process_variables>

    <nonlinear_solvers>
        <nonlinear_solver>
            <name>     basic_newton </name>
            <type>     Newton       </type>
            <max_iter> 50          </max_iter>
            <linear_solver>general_linear_solver</linear_solver>
        </nonlinear_solver>
    </nonlinear_solvers>

     <linear_solvers>
        <linear_solver>
            <name>general_linear_solver</name>
            <lis>-i bicgstab -p ilu -tol 1e-18 -maxiter 10000</lis>
            <eigen>
                <solver_type>BiCGSTAB</solver_type>
                <precon_type>ILUT</precon_type>
                <max_iteration_step>10000</max_iteration_step>
                <error_tolerance>1e-18</error_tolerance>
            </eigen>
            <petsc>
                <prefix>multiphase</prefix>
                <parameters>-gw_ksp_type cg -gw_pc_type bjacobi -gw_ksp_rtol 1e-16 -gw_ksp_max_it 10000</parameters>
            </petsc>
        </linear_solver>
    </linear_solvers>
</OpenGeoSysProject>